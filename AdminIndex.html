<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        background-color: #000;
        color: #fff;
        font-family: 'Inter', sans-serif;
        padding: 40px;
        text-align: center;
      }
      h1 { font-family: 'Oswald', sans-serif; color: #FF4500; text-transform: uppercase; letter-spacing: 2px; }
      .container { max-width: 800px; margin: 0 auto; background: #111; padding: 20px; border-radius: 8px; border: 1px solid #333; }
      table { width: 100%; border-collapse: collapse; margin-top: 20px; }
      th { border-bottom: 2px solid #FF4500; padding: 10px; text-align: left; font-family: 'Oswald', sans-serif; }
      td { padding: 10px; border-bottom: 1px solid #222; text-align: left; }
      .hidden { display: none; }
      .btn-load { background: #FF4500; color: white; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 20px; }
    </style>
  </head>
  <body>

    <div class="container">
      <h1>Buster Admin Backend</h1>
      
      <div id="g_id_onload"
           data-client_id="175744256547-pks0edqho3inl469a63gb6up34efm4u2.apps.googleusercontent.com"
           data-context="signin"
           data-ux_mode="popup"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin" data-type="standard"></div>

      <div id="dashboard" class="hidden">
        <h3>Inner Circle Email List</h3>
        <button class="btn-load" onclick="loadEmails()">Refresh List</button>
        <table id="emailTable">
          <thead>
            <tr>
              <th>Date Joined</th>
              <th>Email Address</th>
            </tr>
          </thead>
          <tbody id="emailBody">
            </tbody>
        </table>
      </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      // 1. Handle the Google Login Response
      function handleCredentialResponse(response) {
        console.log("Encoded JWT ID token: " + response.credential);
        // In a production app, you would verify this token. 
        // For now, we'll reveal the dashboard upon successful login.
        document.getElementById('dashboard').classList.remove('hidden');
        document.querySelector('.g_id_signin').classList.add('hidden');
        loadEmails();
      }

      // 2. Fetch Emails from the Spreadsheet
      function loadEmails() {
        const tbody = document.getElementById('emailBody');
        tbody.innerHTML = "<tr><td colspan='2'>Loading...</td></tr>";

        google.script.run
          .withSuccessHandler(function(data) {
            tbody.innerHTML = "";
            if (data.length === 0) {
              tbody.innerHTML = "<tr><td colspan='2'>No emails yet.</td></tr>";
              return;
            }
            data.forEach(row => {
              const tr = document.createElement('tr');
              // Format date nicely
              const date = new Date(row[0]).toLocaleDateString();
              tr.innerHTML = `<td>${date}</td><td>${row[1]}</td>`;
              tbody.appendChild(tr);
            });
          })
          .getInnerCircleEmails();
      }
    </script>
  </body>
</html>